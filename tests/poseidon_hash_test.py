import pytest

from poseidon_py.poseidon_hash import (
    poseidon_perm,
    poseidon_hash_func,
    poseidon_hash,
    poseidon_hash_single,
    poseidon_hash_many,
)
from poseidon_py.utils import to_bytes


def test_poseidon_perm():
    perm = poseidon_perm(0, 0, 0)
    assert perm == [
        3446325744004048536138401612021367625846492093718951375866996507163446763827,
        1590252087433376791875644726012779423683501236913937337746052470473806035332,
        867921192302518434283879514999422690776342565400001269945778456016268852423,
    ]


def test_poseidon_hash_func():
    hash_ = poseidon_hash_func(to_bytes(0), to_bytes(0))
    assert (
        hash_
        == b"\x02\x93\xd3\xe8\xa8\x0f@\r\xaa\xaf\xfd\xd5\x93.+\xcc\x88\x14\xba\xb8\xf4\x14\xa7]\xca\xcf\x871\x8f\x8b\x14\xc5"
    )


def test_poseidon_hash():
    hash_ = poseidon_hash(0, 0)
    assert (
        hash_
        == 1165814756574493433332935684348403390128033890862827107228326727661107483845
    )


def test_poseidon_hash_single():
    hash_ = poseidon_hash_single(0)
    assert (
        hash_
        == 2713945852911138914608023678711237035749237289914711755736801547179254184987
    )


@pytest.mark.parametrize(
    "values, expected_hash",
    [
        (
            [],
            973835572668429495915136902981656666590582180872133591629269551720657739196,
        ),
        (
            [0],
            2384960345383653703825803024708982182127528589318022519244349682493582074337,
        ),
        (
            [0, 0],
            896574209479572497136278743981523399137388648198307621107561078007966130592,
        ),
        (
            [0, 0, 0],
            1178365997903353884521390882719559178415560920900707116770499317865819663181,
        ),
        (
            [0, 0, 0, 0],
            2609405190254229920918587163025708633135921368210352520578679658478540392757,
        ),
        (
            [1, 2, 3],
            1330163329880897963929329415144033128916878238201091319571200413658610585730,
        ),
        (
            [
                43251436235347542643274,
                35246236432545463564265,
                234724572654366437254274,
            ],
            404707499197491181200816201068661537572885514737923922936922803720346206544,
        ),
        (
            [
                1590252087433376791875644726012779423683501236913937337746052470473806035331,
                0,
                1,
            ],
            613738783061315852385663620082985225008503158133782301968434456475142255420,
        ),
        (
            [
                1575317031406813687724518246540075260292628078796896319476024584111151080566,
                1881749349821485077283454164949781990029379538746570850488875971763643895967,
                3379489860261142300861388663571723742013023150462788192386628889429951775269,
                2926280787968963194760245841111510805663379489860261142300861388663571723742,
                1881749349821485077263571723742013023150462788192380488875971763643895967663,
                3085048887597176364398602611423008613886635717237420130231504627881923866288,
                2788192389860261148507728345416447602458411114164949781990029379538746570850,
                6114230086138866357172374201302315046278819238662888942995177504627888192819,
            ],
            3598313717910589720793030421099270732443913280284142984385248223111384198411,
        ),
    ],
)
def test_poseidon_hash_many(values, expected_hash):
    hash_ = poseidon_hash_many(values)
    assert hash_ == expected_hash
